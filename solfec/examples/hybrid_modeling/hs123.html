<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1,2,3–dimensional cube array acceleration dwell &#8212; PARMES  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/parmes.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="3–dimensional cube array parallel scaling" href="hs3_scaling.html" />
    <link rel="prev" title="A two–body impact problem" href="hs0.html" />
  
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  
  <link rel="alternate" type="application/atom+xml"  href="../../../blog/atom.xml" title="PARMES/blog">
  
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="dimensional-cube-array-acceleration-dwell">
<span id="solfec-examples-hybrid-modeling-hs123"></span><h1>1,2,3&#8211;dimensional cube array acceleration dwell<a class="headerlink" href="#dimensional-cube-array-acceleration-dwell" title="Permalink to this headline">¶</a></h1>
<p>This is a family of 1,2 and 3&#8211;dismenional examples demonstrating applications of the <a class="reference internal" href="../../user/solvers.html#solfec-command-hybrid-solver"><span class="std std-ref">HYBRID_SOLVER</span></a>
on an array of cubes subject to a constant amplitude and frequency acceleration since dwell signal. The input files for these examples
are located in:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/tkoziara/solfec/tree/master/examples/hybrid-solver1">solfec/examples/hybrid&#8211;solver1</a> for the 1&#8211;dimensional array.</li>
<li><a class="reference external" href="https://github.com/tkoziara/solfec/tree/master/examples/hybrid-solver2">solfec/examples/hybrid&#8211;solver2</a> for the 2&#8211;dimensional array.</li>
<li><a class="reference external" href="https://github.com/tkoziara/solfec/tree/master/examples/hybrid-solver3">solfec/examples/hybrid&#8211;solver3</a> for the 3&#8211;dimensional array.</li>
</ul>
<p>We focus on the 2&#8211;dimensional example, leaving the 1&#8211; and 3&#8211;dimensional cases for self&#8211;study. The
<a class="reference external" href="https://github.com/tkoziara/solfec/tree/master/examples/hybrid-solver2">solfec/examples/hybrid&#8211;solver2</a> directory contains:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/tkoziara/solfec/blob/master/examples/hybrid-solver2/README">README</a> &#8211; a text based specification of the problem</li>
<li><a class="reference external" href="https://github.com/tkoziara/solfec/blob/master/examples/hybrid-solver2/hs2-parmec.py">hs2&#8211;parmec.py</a> &#8211; including the <a class="reference internal" href="../../../parmec/index.html#parmec-index"><span class="std std-ref">Parmec</span></a> input code</li>
<li><a class="reference external" href="https://github.com/tkoziara/solfec/blob/master/examples/hybrid-solver2/hs2-solfec.py">hs2&#8211;solfec.py</a> &#8211; including the <a class="reference internal" href="../../index.html#solfec-index"><span class="std std-ref">Solfec</span></a> input code</li>
<li><a class="reference external" href="https://github.com/tkoziara/solfec/blob/master/examples/hybrid-solver2/hs2-state-1.pvsm">hs2&#8211;state&#8211;1.pvsm</a> &#8211; <a class="reference external" href="http://www.paraview.org">ParaView</a> state for animation <a class="footnote-reference" href="#id10" id="id2">[1]</a></li>
<li><a class="reference external" href="https://github.com/tkoziara/solfec/blob/master/examples/hybrid-solver2/hs2-state-2.pvsm">hs2&#8211;state&#8211;2.pvsm</a> &#8211; <a class="reference external" href="http://www.paraview.org">ParaView</a> state for animation <a class="footnote-reference" href="#id13" id="id4">[2]</a></li>
<li><a class="reference external" href="https://github.com/tkoziara/solfec/blob/master/examples/hybrid-solver2/hs2-state-3.pvsm">hs2&#8211;state&#8211;3.pvsm</a> &#8211; <a class="reference external" href="http://www.paraview.org">ParaView</a> state for <a class="reference internal" href="#hs2-fig3"><span class="std std-numref">Fig. 55</span></a></li>
<li><a class="reference external" href="https://github.com/tkoziara/solfec/blob/master/examples/hybrid-solver2/hs2-state-4.pvsm">hs2&#8211;state&#8211;4.pvsm</a> &#8211; <a class="reference external" href="http://www.paraview.org">ParaView</a> state for <a class="reference internal" href="#hs2-fig4"><span class="std std-numref">Fig. 56</span></a></li>
</ul>
<p><a class="reference internal" href="#hs2-fig1"><span class="std std-numref">Fig. 53</span></a> states the problem and describes the hybrid model.</p>
<div class="figure align-center" id="id16">
<span id="hs2-fig1"></span><a class="reference internal image-reference" href="../../../_images/hs2.png"><img alt="../../../_images/hs2.png" src="../../../_images/hs2.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-number">Fig. 53 </span><span class="caption-text">Example <a class="reference external" href="https://github.com/tkoziara/solfec/tree/master/examples/hybrid-solver2">hybrid-solver2</a>: a 2&#8211;dimensional cube array acceleration dwell hybrid model</span></p>
</div>
<p>An actual array geometry is depicted in <a class="reference internal" href="#hs2-fig2"><span class="std std-numref">Fig. 54</span></a>, where the color coding is as follows:</p>
<ul class="simple">
<li>blue &#8211; the outer Parmec bodies where acceleration sweep signal is applied</li>
<li>yellow &#8211; the inner Parmec bodies interacting via spring&#8211;dashpot elements</li>
<li>green &#8211; the boundary Parmec&#8211;Solfec bodies, modeled in both codes</li>
<li>grey &#8211; the inner Solfec bodies, interacting via a non&#8211;smooth contact law</li>
</ul>
<div class="figure align-center" id="id17">
<span id="hs2-fig2"></span><a class="reference internal image-reference" href="../../../_images/hs2-geometry.png"><img alt="../../../_images/hs2-geometry.png" src="../../../_images/hs2-geometry.png" style="width: 60%;" /></a>
<p class="caption"><span class="caption-number">Fig. 54 </span><span class="caption-text">Example <a class="reference external" href="https://github.com/tkoziara/solfec/tree/master/examples/hybrid-solver2">hybrid-solver2</a>: initial geometry.</span></p>
</div>
<p><a class="reference internal" href="#hs2-lst1"><span class="std std-numref">Listing 4</span></a> includes the Parmec file <a class="reference external" href="https://github.com/tkoziara/solfec/blob/master/examples/hybrid-solver2/hs2-parmec.py">hs2&#8211;parmec.py</a>.
Lines 1&#8211;8 define basic parameters of the model. We note, that it is possible to transform the current example into a sine sweep test by changing
the &#8220;hifq&#8221; variable to a value greater than &#8220;lofq&#8221;. Also the size of the problem can be modified by altering the &#8220;N&#8221; and &#8220;M&#8221; parameters.
Lines 10&#8211;25 are Python specific and help to find the path to the parmec source directory, in order to include the acceleration sweep generation
script into the current system path. This is then used in line 30, and further until line 38, to set up the linear motion excitation vector,
where the velocity time history, associated with the sine dwell signal, is used. Following definition of a translate cube creation function,
in lines 43&#8211;58, the array of cubes is generated in lines 60&#8211;68. Then the prescribed motion is applied to the outer shell of cubes in lines 70&#8211;76.
Finally, between the lines 78 and 98 contact spring&#8211;dashpot elements are defined and inserted into the model. For information, the critical time
step estimation for the model is printed out in line 101.</p>
<div class="literal-block-wrapper docutils container" id="hs2-lst1">
<div class="code-block-caption"><span class="caption-number">Listing 4 </span><span class="caption-text">Listing of hs2&#8211;parmec.py</span><a class="headerlink" href="#hs2-lst1" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># must be same as in hs2-solfec.py</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># must be same as in hs2-solfec.py</span>
<span class="n">gap</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># must be same as in hs2-solfec.py</span>
<span class="n">lofq</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># low excitation frequency</span>
<span class="n">hifq</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># high excitation freqency</span>
<span class="n">amag</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># acceleration magnitude</span>
<span class="n">step</span> <span class="o">=</span> <span class="mf">1E-4</span> <span class="c1"># time step</span>
<span class="n">stop</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># must be &gt;= stop in hs2-solfec.py</span>

<span class="c1"># find path to parmec source directory in order</span>
<span class="c1"># to load the acceleration sweep signal script</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="k">def</span> <span class="nf">where</span><span class="p">(</span><span class="n">program</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PATH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">program</span><span class="p">)):</span>
      <span class="k">return</span> <span class="n">path</span>
  <span class="k">return</span> <span class="kc">None</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="s1">&#39;parmec4&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s1">&#39;ERROR: parmec4 not found in PATH!&#39;</span>
  <span class="nb">print</span> <span class="s1">&#39;       Download and compile parmec;&#39;</span><span class="p">,</span>
  <span class="nb">print</span> <span class="s1">&#39;add parmec directory to PATH variable;&#39;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span> <span class="s1">&#39;(Found parmec4 at:&#39;</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">))</span>

<span class="c1"># generate acceleration sweep signal;</span>
<span class="c1"># note that parmec will use the associated</span>
<span class="c1"># velocity signal, rather than the acceleration itself</span>
<span class="kn">from</span> <span class="nn">acc_sweep</span> <span class="k">import</span> <span class="o">*</span>
<span class="p">(</span><span class="n">vt</span><span class="p">,</span> <span class="n">vd</span><span class="p">,</span> <span class="n">vv</span><span class="p">,</span> <span class="n">va</span><span class="p">)</span> <span class="o">=</span> <span class="n">acc_sweep</span> <span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">lofq</span><span class="p">,</span> <span class="n">hifq</span><span class="p">,</span> <span class="n">amag</span><span class="p">)</span>
<span class="n">tsv</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vt</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">vd</span><span class="p">))</span>
<span class="n">tsv</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">vt</span>
<span class="n">tsv</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">vv</span>
<span class="n">tsv</span> <span class="o">=</span> <span class="n">TSERIES</span> <span class="p">(</span><span class="n">tsv</span><span class="p">)</span> <span class="c1"># velocity time series</span>
<span class="n">ts0</span> <span class="o">=</span> <span class="n">TSERIES</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">)</span> <span class="c1"># constant, zero &quot;time series&quot;</span>
<span class="n">linvel</span> <span class="o">=</span> <span class="p">(</span><span class="n">tsv</span><span class="p">,</span> <span class="n">tsv</span><span class="p">,</span> <span class="n">ts0</span><span class="p">)</span> <span class="c1"># linear motion excitation vector</span>
<span class="n">angvel</span> <span class="o">=</span> <span class="p">(</span><span class="n">ts0</span><span class="p">,</span> <span class="n">ts0</span><span class="p">,</span> <span class="n">ts0</span><span class="p">)</span> <span class="c1"># angular motion excitation vector</span>

<span class="c1"># create material</span>
<span class="n">matnum</span> <span class="o">=</span> <span class="n">MATERIAL</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mf">1E6</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>

<span class="c1"># cube creation function</span>
<span class="k">def</span> <span class="nf">cube</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
  <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
	   <span class="n">x</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
	   <span class="n">x</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
	   <span class="n">x</span><span class="o">+</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
	   <span class="n">x</span><span class="o">+</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span>
	   <span class="n">x</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span>
	   <span class="n">x</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span>
	   <span class="n">x</span><span class="o">+</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
  <span class="n">elements</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">matnum</span><span class="p">]</span>
  <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
  <span class="n">parnum</span> <span class="o">=</span> <span class="n">MESH</span> <span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">matnum</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span>
  <span class="n">RESTRAIN</span> <span class="p">(</span><span class="n">parnum</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
  <span class="n">ANALYTICAL</span> <span class="p">(</span><span class="n">particle</span><span class="o">=</span><span class="n">parnum</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">parnum</span>

<span class="c1"># generate cube pattern</span>
<span class="n">ijmap</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">M</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">M</span><span class="p">):</span>
    <span class="c1"># skip the inner NxN Solfec block</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">M</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="n">M</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">M</span><span class="o">+</span><span class="n">N</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="p">:</span> <span class="k">continue</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># create the outer MxM, NxM, MxN blocks</span>
      <span class="n">num</span> <span class="o">=</span> <span class="n">cube</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="mf">0.1</span><span class="o">+</span><span class="n">gap</span><span class="p">),</span> <span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="mf">0.1</span><span class="o">+</span><span class="n">gap</span><span class="p">))</span>
      <span class="n">ijmap</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">num</span> <span class="c1"># map body numbers to (i,j)-grid</span>

<span class="c1"># prescribe sine dwell motion </span>
<span class="c1"># of the outer-most shell of bodies</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ijmap</span><span class="p">:</span>
  <span class="n">outer</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">outer</span> <span class="ow">or</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">outer</span><span class="p">:</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">ijmap</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span>
    <span class="n">PRESCRIBE</span> <span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">linvel</span><span class="p">,</span> <span class="n">angvel</span><span class="p">)</span>

<span class="c1"># spring-damper curves</span>
<span class="n">spring_curve</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">gap</span><span class="p">,</span> <span class="o">-</span><span class="mf">1E3</span><span class="p">,</span> <span class="o">-</span><span class="n">gap</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">damper_curve</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>

<span class="c1"># insert contact springs</span>
<span class="n">ijmax</span> <span class="o">=</span> <span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ijmap</span><span class="p">:</span>
  <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ijmax</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">M</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="p">)):</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="mf">0.1</span><span class="o">+</span><span class="n">gap</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="mf">0.1</span><span class="o">+</span><span class="n">gap</span><span class="p">)</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="mf">0.1</span><span class="o">+</span><span class="n">gap</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="o">+</span><span class="n">gap</span><span class="p">,</span> <span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="mf">0.1</span><span class="o">+</span><span class="n">gap</span><span class="p">)</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">ijmap</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span>
    <span class="n">n2</span> <span class="o">=</span> <span class="n">ijmap</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span>
    <span class="n">SPRING</span> <span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">spring_curve</span><span class="p">,</span>
            <span class="n">damper_curve</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
  <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">ijmax</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">M</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="p">)):</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="mf">0.1</span><span class="o">+</span><span class="n">gap</span><span class="p">)</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="mf">0.1</span><span class="o">+</span><span class="n">gap</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="mf">0.1</span><span class="o">+</span><span class="n">gap</span><span class="p">)</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="mf">0.1</span><span class="o">+</span><span class="n">gap</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="o">+</span><span class="n">gap</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">ijmap</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span>
    <span class="n">n2</span> <span class="o">=</span> <span class="n">ijmap</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">SPRING</span> <span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">spring_curve</span><span class="p">,</span>
            <span class="n">damper_curve</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># FYI, print out critical time step information </span>
<span class="nb">print</span> <span class="s1">&#39;PARMEC estimated critical time step:&#39;</span><span class="p">,</span> <span class="n">CRITICAL</span><span class="p">()</span>

<span class="c1">#DEM (stop, step, 0.01)</span>
</pre></div>
</td></tr></table></div>
</div>
<p><a class="reference internal" href="#hs2-lst2"><span class="std std-numref">Listing 5</span></a> includes the Solfec file <a class="reference external" href="https://github.com/tkoziara/solfec/blob/master/examples/hybrid-solver2/hs2-solfec.py">hs2&#8211;solfec.py</a>.
Lines 1&#8211;5 define the global model parameters. Lines 7&#8211;24 set up the <a class="reference internal" href="../../user/solfec.html#solfec-user-solfec"><span class="std std-ref">SOLFEC object</span></a>,
<a class="reference internal" href="../../user/materials.html#solfec-command-bulk-material"><span class="std std-ref">bulk</span></a> and <a class="reference internal" href="../../user/materials.html#solfec-command-surface-material"><span class="std std-ref">surface</span></a> materials, and a unit
cube template. Lines 26&#8211;56 contain code creating the array of Solfec bodies as well as the mapping between the
Parmec and the Solfec body numbers. The double loop starting in line 30 of <a class="reference internal" href="#hs2-lst2"><span class="std std-numref">Listing 5</span></a> mimics the double loop
starting in line 62 of <a class="reference internal" href="#hs2-lst1"><span class="std std-numref">Listing 4</span></a>. This way, it is easy to recreate the exact sequence of creation of Parmec
bodies within the Solfec input file. Hence, it is easy to construct the <em>parmec2solfec</em> dictionary mapping of body numbers,
on the fly, while creating the Solfec model. The inner Solfec bodies (grey in <a class="reference internal" href="#hs2-fig2"><span class="std std-numref">Fig. 54</span></a>) are created in lines 33&#8211;45.
This same range of i, j indices is skipped in the Parmec input file (line 65 in <a class="reference internal" href="#hs2-lst1"><span class="std std-numref">Listing 4</span></a>). Here, finite element
bodies are created, based on a 2x2x2 <a class="reference internal" href="../../user/geometry.html#solfec-command-hex"><span class="std std-ref">hexahedral mesh</span></a>. The z&#8211;direction of the bodies is <a class="reference internal" href="../../user/constraints.html#solfec-command-fix-direction"><span class="std std-ref">fixed</span></a>
to keep them in plane. The rigid &#8220;boundary&#8221; bodies for the Solfec&#8211;Parmec overlap interface are created in lines 50&#8211;53. We note,
that when a Solfec input file is run in parallel (using <em>solfec-mpi</em>) some of the bodies that are created in the loop may actually
reside on other processor ranks. Hence we test this using the <a class="reference internal" href="../../user/simulation.html#solfec-command-here"><span class="std std-ref">HERE command</span></a> and accordingly create
valid fragments of the parmec2solfec mapping on each MPI rank. Such fragmentary mappings are brought together during initialization
of the <a class="reference internal" href="../../user/solvers.html#solfec-command-hybrid-solver"><span class="std std-ref">HYBRID_SOLVER</span></a>. In line 56 the Parmec body index is advanced, as this line corresponds
to line 67 in <a class="reference internal" href="#hs2-lst1"><span class="std std-numref">Listing 4</span></a>, where Parmec bodies are created. The rest of the file is similar to that already detailed in the
description of <a class="reference internal" href="hs0.html#hs0-lst3"><span class="std std-numref">Listing 3</span></a>, in the context of the <a class="reference internal" href="hs0.html#solfec-examples-hybrid-modeling-hs0"><span class="std std-ref">two body impact example</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="hs2-lst2">
<div class="code-block-caption"><span class="caption-number">Listing 5 </span><span class="caption-text">Listing of hs2&#8211;solfec.py</span><a class="headerlink" href="#hs2-lst2" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># must be same as in hs2-paremc.py</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># must be same as in hs2-paremc.py</span>
<span class="n">gap</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># must be same as in hs2-paremc.py</span>
<span class="n">step</span> <span class="o">=</span> <span class="mf">5E-4</span> <span class="c1"># time step</span>
<span class="n">stop</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># must be &lt;= stop in hs2-parmec.py</span>

<span class="c1"># create solfec object</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">SOLFEC</span> <span class="p">(</span><span class="s1">&#39;DYNAMIC&#39;</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="s1">&#39;out/hybrid-solver2&#39;</span><span class="p">)</span>

<span class="c1"># bulk and surface materials</span>
<span class="n">mat</span> <span class="o">=</span> <span class="n">BULK_MATERIAL</span> <span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;KIRCHHOFF&#39;</span><span class="p">,</span>
  <span class="n">young</span> <span class="o">=</span> <span class="mf">1E6</span><span class="p">,</span> <span class="n">poisson</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">density</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">SURFACE_MATERIAL</span> <span class="p">(</span><span class="n">sol</span><span class="p">,</span>
  <span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;SIGNORINI_COULOMB&#39;</span><span class="p">,</span> <span class="n">friction</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># template cube nodes</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
         <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
	 <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
	 <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
	 <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span>
	 <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span>
	 <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span>
	 <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>

<span class="c1"># create the array of cubes</span>
<span class="n">iparmec</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># parmec indexing</span>
<span class="n">parmec2solfec</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># boundary bodies mapping</span>
<span class="n">isolfec</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># solfec indexing</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">M</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">M</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">M</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="n">M</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">M</span><span class="o">+</span><span class="n">N</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="p">:</span>
      <span class="c1"># inner Solfec bodies</span>
      <span class="n">msh</span> <span class="o">=</span> <span class="n">HEX</span> <span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
      <span class="n">TRANSLATE</span> <span class="p">(</span><span class="n">msh</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="mf">0.1</span><span class="o">+</span><span class="n">gap</span><span class="p">),</span> <span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="mf">0.1</span><span class="o">+</span><span class="n">gap</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
      <span class="n">p1</span> <span class="o">=</span> <span class="n">msh</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
      <span class="n">p2</span> <span class="o">=</span> <span class="n">msh</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">p3</span> <span class="o">=</span> <span class="n">msh</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
      <span class="n">bod</span> <span class="o">=</span> <span class="n">BODY</span> <span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="s1">&#39;FINITE_ELEMENT&#39;</span><span class="p">,</span> <span class="n">msh</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
      <span class="n">bod</span><span class="o">.</span><span class="n">scheme</span> <span class="o">=</span> <span class="s1">&#39;DEF_LIM&#39;</span> <span class="c1"># semi-implicit time integration</span>
      <span class="n">bod</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mf">1E-4</span> <span class="c1"># damping out free vibrations</span>
      <span class="n">isolfec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bod</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
      <span class="n">FIX_DIRECTION</span> <span class="p">(</span><span class="n">bod</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
      <span class="n">FIX_DIRECTION</span> <span class="p">(</span><span class="n">bod</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
      <span class="n">FIX_DIRECTION</span> <span class="p">(</span><span class="n">bod</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="p">]</span> <span class="ow">and</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="p">))</span> <span class="ow">or</span> \
	 <span class="p">(</span><span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="p">))</span> <span class="ow">or</span> \
	 <span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="p">]</span> <span class="ow">and</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="p">]):</span>
	<span class="c1"># Solfec-Parmec boundary</span>
	<span class="n">msh</span> <span class="o">=</span> <span class="n">HEX</span> <span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
	<span class="n">TRANSLATE</span> <span class="p">(</span><span class="n">msh</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="mf">0.1</span><span class="o">+</span><span class="n">gap</span><span class="p">),</span> <span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="mf">0.1</span><span class="o">+</span><span class="n">gap</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
	<span class="n">bod</span> <span class="o">=</span> <span class="n">BODY</span> <span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="s1">&#39;RIGID&#39;</span><span class="p">,</span> <span class="n">msh</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
        <span class="c1"># in parallel bod.id can be None for remote bodies, so</span>
	<span class="k">if</span> <span class="n">HERE</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span><span class="n">bod</span><span class="p">):</span> <span class="n">parmec2solfec</span><span class="p">[</span><span class="n">iparmec</span><span class="p">]</span> <span class="o">=</span> <span class="n">bod</span><span class="o">.</span><span class="n">id</span>
      <span class="n">iparmec</span> <span class="o">=</span> <span class="n">iparmec</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># next parmec body</span>

<span class="c1"># create Newton solver</span>
<span class="n">ns</span> <span class="o">=</span> <span class="n">NEWTON_SOLVER</span> <span class="p">()</span>

<span class="c1"># parmec&#39;s output files are written to the same</span>
<span class="c1"># location as the input path; for that to be the solfec&#39;s</span>
<span class="c1"># output directory, we copy parmec&#39;s input file there</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="k">import</span> <span class="n">copyfile</span>
<span class="n">copyfile</span><span class="p">(</span><span class="s1">&#39;examples/hybrid-solver2/hs2-parmec.py&#39;</span><span class="p">,</span>
         <span class="s1">&#39;out/hybrid-solver2/hs2-parmec.py&#39;</span><span class="p">)</span>


<span class="c1"># create hybrid solver</span>
<span class="n">hs</span> <span class="o">=</span> <span class="n">HYBRID_SOLVER</span> <span class="p">(</span><span class="s1">&#39;out/hybrid-solver2/hs2-parmec.py&#39;</span><span class="p">,</span>
                    <span class="mf">1E-4</span><span class="p">,</span> <span class="n">parmec2solfec</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>

<span class="c1"># set PARMEC output interval</span>
<span class="n">hs</span><span class="o">.</span><span class="n">parmec_interval</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">solfec</span> <span class="k">as</span> <span class="nn">solfec</span> <span class="c1"># this is needed since &#39;OUTPUT&#39; in Solfec</span>
<span class="n">solfec</span><span class="o">.</span><span class="n">OUTPUT</span> <span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">)</span> <span class="c1"># collides with &#39;OUTPUT&#39; in Parmec</span>

<span class="c1"># run simulation</span>
<span class="n">RUN</span> <span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>

<span class="c1"># XDMF export</span>
<span class="k">if</span> <span class="n">sol</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;READ&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">VIEWER</span><span class="p">():</span>
  <span class="n">XDMF_EXPORT</span> <span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">stop</span><span class="p">),</span>
    <span class="s1">&#39;out/hybrid-solver2/hs2-solfec&#39;</span><span class="p">,</span> <span class="n">isolfec</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<p>The example is run by invoking</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">solfec</span> <span class="n">examples</span><span class="o">/</span><span class="n">hybrid</span><span class="o">-</span><span class="n">solfec2</span><span class="o">/</span><span class="n">hs2</span><span class="o">-</span><span class="n">solfec</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>which needs to be followed by a repeated call</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">solfec</span> <span class="n">examples</span><span class="o">/</span><span class="n">hybrid</span><span class="o">-</span><span class="n">solfec2</span><span class="o">/</span><span class="n">hs2</span><span class="o">-</span><span class="n">solfec</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>in order to produce the XDMF&#8211;exported Solfec results. These will be located in the &#8216;out/hybrid&#8211;solver2/hs2&#8211;solfec&#8217; directory,
relative to the solfec source directory, from where this example is conveniently called. The Parmec output files are located
in the &#8216;out/hybrid&#8211;solver2&#8217; directory. While Solfec viewer can be used to view and post&#8211;process the Solfec part of the results
without depending on the exported XDMF files, <a class="reference external" href="http://www.paraview.org">ParaView</a> can be used to post&#8211;process the generated .xmf files.
The application of ParaView can be simplified by utilising the two state .pvsm files distributed with the example: by selecting
&#8220;File/Load State...&#8221; menu choice in ParaView one can load a pre&#8211;set post&#8211;processing state. The videos included below depict the
forced motion of the hybrid system, visualised using the two enclosed states files.</p>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td><a class="reference external" href="http://www.paraview.org">ParaView</a> animation based on the state file
<a class="reference external" href="https://github.com/tkoziara/solfec/blob/master/examples/hybrid-solver2/hs2-state-1.pvsm">hs2&#8211;state&#8211;1.pvsm</a>.</td></tr>
</tbody>
</table>
<p align="center"><iframe width="648" height="432" src="//www.youtube.com/embed/Eg_Qm2tOtIY?rel=0" frameborder="0" allowfullscreen="1">&nbsp;</iframe></p><table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[2]</a></td><td><a class="reference external" href="http://www.paraview.org">ParaView</a> animation based on the state file
<a class="reference external" href="https://github.com/tkoziara/solfec/blob/master/examples/hybrid-solver2/hs2-state-2.pvsm">hs2&#8211;state&#8211;2.pvsm</a>.</td></tr>
</tbody>
</table>
<p align="center"><iframe width="648" height="432" src="//www.youtube.com/embed/EzyFSkX7lLM?rel=0" frameborder="0" allowfullscreen="1">&nbsp;</iframe></p><p><a class="reference internal" href="#hs2-fig3"><span class="std std-numref">Fig. 55</span></a> and <a class="reference internal" href="#hs2-fig4"><span class="std std-numref">Fig. 56</span></a> respectively show the linear velocity magnitude time history and the displacement magnitude
time history, at points A (Parmec) and B (Solfec), marked out in <a class="reference internal" href="#hs2-fig2"><span class="std std-numref">Fig. 54</span></a>. These plots were generated using ParaView&#8217;s &#8220;Plot
Selection Over Time&#8221; feature.</p>
<div class="figure align-center" id="id18">
<span id="hs2-fig3"></span><a class="reference internal image-reference" href="../../../_images/hs2-linvel-mag.png"><img alt="../../../_images/hs2-linvel-mag.png" src="../../../_images/hs2-linvel-mag.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-number">Fig. 55 </span><span class="caption-text">Example <a class="reference external" href="https://github.com/tkoziara/solfec/tree/master/examples/hybrid-solver2">hybrid-solver2</a>: Linear velocity magnitude history at points A and B (<a class="reference internal" href="#hs2-fig2"><span class="std std-numref">Fig. 54</span></a>).</span></p>
</div>
<div class="figure align-center" id="id19">
<span id="hs2-fig4"></span><a class="reference internal image-reference" href="../../../_images/hs2-disp-mag.png"><img alt="../../../_images/hs2-disp-mag.png" src="../../../_images/hs2-disp-mag.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-number">Fig. 56 </span><span class="caption-text">Example <a class="reference external" href="https://github.com/tkoziara/solfec/tree/master/examples/hybrid-solver2">hybrid-solver2</a>: Displacement magnitude history at points A and B (<a class="reference internal" href="#hs2-fig2"><span class="std std-numref">Fig. 54</span></a>).</span></p>
</div>
</div>

  <div class="section">
  
  
  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">PARMES</a></h1>



<p class="blurb">Parallel mechanics and particulate media software blog</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=parmes&repo=parmes&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">SOLFEC</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../running.html">Running</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user.html">User Manual</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../theory.html">Theory Manual</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../validation.html">Validation Manual</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../xdmf.html">XDMF export</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../applications.html">Applications</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../examples.html">Examples</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../hybrid_modeling.html">Hybrid modeling</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="hs0.html">A two&#8211;body impact problem</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">1,2,3&#8211;dimensional cube array acceleration dwell</a></li>
<li class="toctree-l4"><a class="reference internal" href="hs3_scaling.html">3&#8211;dimensional cube array parallel scaling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reduced_order.html">Reduced order modeling</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../dynlb/index.html">DYNLB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parmec/index.html">PARMEC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../vbox/index.html">VBOX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tgz/index.html">TGZ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trs/index.html">TRs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../blog/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../patreon.html">Patreon</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">SOLFEC</a><ul>
  <li><a href="../../examples.html">Solfec Examples</a><ul>
  <li><a href="../hybrid_modeling.html">Hybrid modeling</a><ul>
      <li>Previous: <a href="hs0.html" title="previous chapter">A two&#8211;body impact problem</a></li>
      <li>Next: <a href="hs3_scaling.html" title="next chapter">3&#8211;dimensional cube array parallel scaling</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h3><a href="../../../blog.html">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../../../blog/tr1_post.html">May 20 - TR1: Co-rotated and reduced order time integrators</a></li>
    
      <li><a href="../../../blog/hybrid_solver.html">Apr 27 - Hybrid solver in Solfec</a></li>
    
      <li><a href="../../../blog/about.html">Jun 13 - About PARMES</a></li>
    
  </ul>

  <h3><a href="../../../blog/tag.html">Tags</a></h3>
  <style type="text/css">
    ul.ablog-cloud {list-style: none; overflow: auto;}
    ul.ablog-cloud li {float: left; height: 20pt; line-height: 18pt; margin-right: 5px;}
    ul.ablog-cloud a {text-decoration: none; vertical-align: middle;}
    li.ablog-cloud-1{font-size: 80%;}
    li.ablog-cloud-2{font-size: 95%;}
    li.ablog-cloud-3{font-size: 110%;}
    li.ablog-cloud-4{font-size: 125%;}
    li.ablog-cloud-5{font-size: 140%;}
  </style>
  <ul class="ablog-cloud">
    
      
      <li class="ablog-cloud ablog-cloud-3">
        <a href="../../../blog/tag/parmec.html">parmec</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-3">
        <a href="../../../blog/tag/parmes.html">parmes</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-3">
        <a href="../../../blog/tag/reports.html">reports</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-3">
        <a href="../../../blog/tag/solfec.html">solfec</a></li>
      
    
  </ul>

  <h3><a href="../../../blog/archive.html">Archives</a></h3>
  <ul>
  
    
    <li><a href="../../../blog/2017.html">2017 (2)</a></li>
    
  
    
    <li><a href="../../../blog/2016.html">2016 (1)</a></li>
    
  
  </ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017 PARMES team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="../../../_sources/solfec/examples/hybrid_modeling/hs123.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>